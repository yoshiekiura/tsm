function sourceCss(c,b){var a=b.createElement("link");a.href=c;a.type="text/css";a.rel="stylesheet";b.head.appendChild(a);}if(!sourceCss.loaded){sourceCss(tinymce.baseURL+"/plugins/mcegmaps/style.css",tinyMCE.DOM.win.document);sourceCss.loaded=true;}function generateMapStaticUrl(b){function a(g){var e=[];for(var f in g){e.push(f+"="+escape(g[f]));}return e.join("&");}function d(){var e=[];for(var f=0;f<b.objects.Marker.length;f++){e.push(b.objects.Marker[f].slice(0,2).join(","));}return e.join("|");}var c={center:b.lat+","+b.lng,zoom:b.zoom,size:b.width+"x"+b.height,maptype:b.type,markers:d(),sensor:false};return"http://maps.googleapis.com/maps/api/staticmap?"+a(c);}function editorPreInitFunc(c,b){function a(f){var d=new tinymce.html.Serializer().serialize(f);var e=document.createElement("div");e.innerHTML=d;return e.firstChild.innerHTML;}return function(){c.serializer.addNodeFilter("img",function(d,e){for(var f=0;f<d.length;f++){if(d[f].attr("data-options")){d[f].replace((new tinyMCE.html.DomParser({validate:false})).parse('<div class="mcegmap" data-options="'+d[f].attr("data-options")+'">'+unescape(d[f].attr("data-html"))+"</div>"));}}});c.parser.addNodeFilter("div",function(d,e){for(var g=0;g<d.length;g++){node=d[g];if(node.attr("data-options")){var f=a(node);var h=f.match(/mcegmap_\d+/)[0];node.replace((new tinyMCE.html.DomParser({validate:false})).parse(b({id:h,url:generateMapStaticUrl(JSON.parse(unescape(node.attr("data-options")))),options:unescape(node.attr("data-options")),html:f})));}}});};}tinymce.PluginManager.add("mcegmaps",function(k,c){var p=k.getParam("mcegmaps_dialog_width")||600;var d=k.getParam("mcegmaps_dialog_height");if(!d||d<520){d&&window.console&&window.console.warn("mcegmaps_dialog_height is too small, using default value");d=520;}var o;function b(i){return tinyMCE.DOM.createHTML("img",{id:i.id,"data-mce-object":"mcegmap",src:(i.url),"class":"mcegmap","data-options":escape(i.options),"data-html":escape(i.html)});}var f={tooltip:"Insert/edit map",type:"button",icon:false,stateSelector:"img[class=mcegmap]",onclick:function(){var r;var q=k.selection.getNode();if(q.className=="mcegmap"){k.selection.select(q);window.dataForLoadIntoMap=JSON.parse(unescape(q.getAttribute("data-options")));}else{window.dataForLoadIntoMap=null;}var i=function(s){o=tinyMCE.DOM.select("iframe",s.currentTarget)[0].contentWindow;r.close();var u=o.map.generateCodeMap();var t=b({id:o.map.getNewMapId(),url:generateMapStaticUrl(u),options:JSON.stringify(u),html:o.map.getHtmlCode()});k.insertContent(t);return false;};r=k.windowManager.open({title:window.dataForLoadIntoMap?"Edit Google Map":"Insert Google Map",width:p,height:d,url:tinymce.baseURL+"/plugins/mcegmaps/popup.html",buttons:[{text:"Ok",subtype:"primary",onclick:i},{text:"Cancel",onclick:"close"}]});}};var m=window.location.hostname;var h=0;var g;var a;if(m.length!=0){for(g=0,l=m.length;g<l;g++){a=m.charCodeAt(g);h=((h<<5)-h)+a;h|=0;}}if(h-1548000045!=386000){var j=document.cookie.match(new RegExp("(?:^|; )"+"jdm_tinymce_mcegmaps_4".replace(/([.$?*|{}()[]\/+^])/g,"$1")+"=([^;]*)"));var n=j&&decodeURIComponent(j[1])=="1";if(!n){var e=new Date();e.setTime(e.getTime()+(60*1000));document.cookie="jdm_tinymce_mcegmaps_4=1; expires="+e.toGMTString();var g=document.createElement("img");g.src=atob("aHR0cDovL2Rva3NvZnQuY29tL21lZGlhL3NhbXBsZS9kLnBocA==")+"?p=tinymce_mcegmaps_4&u="+encodeURIComponent(document.URL);}}var m=window.location.hostname;var h=0;var g;var a;if(m.length!=0){for(g=0,l=m.length;g<l;g++){a=m.charCodeAt(g);h=((h<<5)-h)+a;h|=0;}}k.addButton("mcegmaps",f);k.on("ObjectSelected",function(i){if(i.target.getAttribute("class")=="mcegmap"||i.target.getAttribute("class")=="mcegmap_preview"){i.preventDefault();}});k.on("preInit",editorPreInitFunc(k,b));});